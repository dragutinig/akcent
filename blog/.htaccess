# Omogućavanje mod_rewrite
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /blog/

    # Force blog directory index to PHP front page (avoid blank /blog/index.html)
    DirectoryIndex php/index.php

    # Legacy /php URL-ove preusmeri na čiste URL-ove bez /php
    RewriteRule ^php/?$ /blog/ [L,R=301]
    RewriteCond %{THE_REQUEST} \s/+blog/php/index\.php[\s?] [NC]
    RewriteRule ^php/index\.php$ /blog/ [L,R=301]
    # Uvek serviraj blog početnu na /blog/
    RewriteRule ^$ php/index.php [L,QSA]

    # Redirektuj /admin na dashboard
    RewriteRule ^admin$ php/dashboard.php [L,R=302]

    # Preusmeravanje za postove: /category/slug/
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^([^/]+)/([^/]+)/?$ php/post.php?category=$1&slug=$2 [L,QSA]

    # Preusmeravanje za kategorije: /slug/
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^([^/]+)/?$ php/category.php?slug=$1 [L,QSA]

    # Omogućavanje simboličkih linkova
    Options +FollowSymlinks

    # Detekcija protokola, ali bez forsiranja HTTPS-a
    RewriteCond %{HTTPS} =on
    RewriteRule ^ - [env=proto:https]
    RewriteCond %{HTTPS} !=on
    RewriteRule ^ - [env=proto:http]

    # Preusmeravanje svih HTTP zahteva na HTTPS
    RewriteCond %{HTTPS} off
    RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</IfModule>

# Sprečavanje indeksiranja direktorijuma
Options -Indexes

# Blokiranje pristupa osetljivim fajlovima
<FilesMatch "\.(htaccess|htpasswd|ini|log|env)">
    Order allow,deny
    Deny from all
</FilesMatch>

# Content-Security-Policy (CSP) - omogućava učitavanje resursa sa samog domena, CDN-a i omogućava inline skripte i stilove
Header set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://code.jquery.com https://stackpath.bootstrapcdn.com https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://stackpath.bootstrapcdn.com https://fonts.googleapis.com https://cdn.jsdelivr.net; img-src 'self'; font-src 'self' https://fonts.gstatic.com; connect-src 'self'; object-src 'none'; base-uri 'self'; form-action 'self';"
